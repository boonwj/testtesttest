---
name: System Connection Form
description: >
  Use this template to provide the necessary information required for sys-conn setup.
  It also provides a tracking list for actions an admins needs to perform.
title: "[Sys-Conn Request]: "
labels: "service request"
assignees:
  - boonwj
  - wykeith
body:
  - type: markdown
    attributes:
      value: |
        ## System Connection Setup Details
  - type: input
    id: dr-id
    attributes:
      label: Data Request ID(s)
      description: The Data Request (DR) ID(s) that will be used by this system connection.
      placeholder: DUMMY-2024-08-001, DUMMY-2024-05-005
    validations:
      required: true
  - type: dropdown
    id: environment
    attributes:
      label: Environment
      description: Which environment is this for (PRD / STG)
      options:
        - PRD
        - STG
    validations:
      required: true
  - type: dropdown
    id: sys-conn-type
    attributes:
      label: System Connection Type
      description: What type of system connection?
      multiple: true
      options:
        - API (SPN)
        - SF (SPN)
        - SF (Key Pair)
    validations:
      required: true
  - type: input
    id: spn-name
    attributes:
      label: Service Principal Name
      description: The service principal name that will use the system connection
      placeholder: spn-<agency>-<project>-<env>-<name>
    validations:
      required: true
  - type: input
    id: ip-whitelist
    attributes:
      label: System IP address(es)
      description: The IP address(es) used by the calling system
    validations:
      required: true
  - type: textarea
    id: public-key
    attributes:
      label: Public Key (if used)
      description: The public key that will be used for Key Pair authentication
  - type: textarea
    id: misc
    attributes:
      label: Other Information
      description: Any other information to provide for this system connection?
  - type: markdown
    attributes:
      value: |
        ## Admin Checklist        
        ### SPN Authentication
        - [ ] Raise AIS SR to add new role in app registration
          - i.e. session:role:dr_id_lower_case
        - [ ] Raise AIS SR to grant SPN role in app
          - i.e. session:role:public & session:role:dr_id_lower_case
        - [ ] Store AIS SRs into DCS folder
          - INSERT DIRECTORY PATH HERE
        - [ ] Check SPN's object ID (OID, using cli tool)
        - [ ] PR copy of `notebooks/frontend/onboard_sys_conn_service_principal.py` in `tcs-core`
        - [ ] Notify users 
        ### Key Pair Authentication
        - [ ] Generate a `user_id` (using UUID4)
          - Either via: https://www.uuidgenerator.net/ or `python -c 'import uuid; print(uuid.uuid4())'`
        - [ ] PR copy of `notebooks/frontend/onboard_sys_conn_service_principal.py` in `tcs-core`
        - [ ] Notify users
        > Users 
